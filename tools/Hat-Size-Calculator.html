<!DOCTYPE html>
<!-- Category: Fashion & Lifestyle -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Hat Size Calculator - A user-friendly tool to calculate your perfect hat size based on head measurements. Find your hat size in inches, centimeters, and standard sizing systems.">
    <meta name="keywords" content="hat size calculator, hat size chart, head measurement tool, hat sizing guide, hat fit calculator, head circumference calculator, hat size converter">
    <title>Hat Size Calculator</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            min-height: 100vh;
            padding: 0;
        }

        /* Desktop Styles */
        @media (min-width: 769px) {
            header {
                background: linear-gradient(90deg, #6610f2, #520dc2);
                color: white;
                padding: 0 20px;
                height: 70px;
                display: flex;
                align-items: center;
                justify-content: center;
                box-shadow: 0 2px 10px rgba(0,0,0,0.1);
                position: sticky;
                top: 0;
                z-index: 100;
            }

            .container {
                max-width: 1200px;
                margin: 30px auto;
                padding: 0 20px;
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 30px;
            }

            .card {
                background: white;
                border-radius: 15px;
                padding: 30px;
                box-shadow: 0 5px 20px rgba(0,0,0,0.08);
                transition: transform 0.3s ease;
            }

            .card:hover {
                transform: translateY(-5px);
            }

            h1 {
                font-size: 28px;
                font-weight: 600;
                text-align: center;
            }

            h2 {
                color: #6610f2;
                margin-bottom: 20px;
                font-size: 22px;
                display: flex;
                align-items: center;
                gap: 10px;
            }

            .form-group {
                margin-bottom: 20px;
            }

            label {
                display: block;
                margin-bottom: 8px;
                font-weight: 500;
                color: #333;
            }

            input, select, textarea {
                width: 100%;
                padding: 12px 15px;
                border: 2px solid #e1e8ed;
                border-radius: 8px;
                font-size: 16px;
                transition: border-color 0.3s;
            }

            input:focus, select:focus, textarea:focus {
                outline: none;
                border-color: #6610f2;
                box-shadow: 0 0 0 3px rgba(102, 16, 242, 0.1);
            }

            button {
                background: linear-gradient(90deg, #6610f2, #520dc2);
                color: white;
                border: none;
                padding: 14px 25px;
                border-radius: 8px;
                cursor: pointer;
                font-size: 16px;
                font-weight: 600;
                transition: all 0.3s ease;
                width: 100%;
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 8px;
            }

            button:hover {
                transform: translateY(-2px);
                box-shadow: 0 5px 15px rgba(102, 16, 242, 0.3);
            }

            .btn-secondary {
                background: linear-gradient(90deg, #6c757d, #495057);
            }

            .btn-danger {
                background: linear-gradient(90deg, #dc3545, #a71e2a);
            }

            .btn-info {
                background: linear-gradient(90deg, #17a2b8, #117a8b);
            }

            .conversion-results {
                background: #f8f9fa;
                border-radius: 10px;
                padding: 25px;
                margin-top: 20px;
                border-left: 4px solid #6610f2;
            }

            .result-item {
                display: flex;
                justify-content: space-between;
                padding: 12px 0;
                border-bottom: 1px solid #e9ecef;
            }

            .result-item:last-child {
                border-bottom: none;
            }

            .result-label {
                font-weight: 500;
                color: #495057;
            }

            .result-value {
                font-weight: 600;
                color: #6610f2;
            }

            .no-results {
                text-align: center;
                color: #666;
                padding: 30px;
                font-style: italic;
            }

            .clear-data {
                margin-top: 20px;
                text-align: center;
            }

            .stats-container {
                display: grid;
                grid-template-columns: repeat(3, 1fr);
                gap: 15px;
                margin-bottom: 25px;
            }

            .stat-card {
                background: linear-gradient(135deg, #6610f2, #520dc2);
                color: white;
                padding: 20px;
                border-radius: 10px;
                text-align: center;
            }

            .stat-number {
                font-size: 24px;
                font-weight: bold;
                margin-bottom: 5px;
            }

            .stat-label {
                font-size: 14px;
                opacity: 0.9;
            }

            .filter-section {
                display: flex;
                gap: 15px;
                margin-bottom: 20px;
            }

            .filter-select {
                flex: 1;
            }

            .search-box {
                flex: 2;
                position: relative;
            }

            .search-box input {
                padding-left: 40px;
            }

            .search-box i {
                position: absolute;
                left: 15px;
                top: 50%;
                transform: translateY(-50%);
                color: #666;
            }

            .reminder-section {
                background: #fff3cd;
                border-left: 4px solid #ffc107;
                padding: 15px;
                border-radius: 8px;
                margin-bottom: 20px;
            }

            .reminder-section h3 {
                color: #856404;
                margin-bottom: 10px;
                display: flex;
                align-items: center;
                gap: 10px;
            }

            .reminder-section ul {
                padding-left: 20px;
            }

            .reminder-section li {
                margin-bottom: 8px;
                color: #666;
            }

            .size-chart {
                margin-top: 25px;
            }

            .size-chart h3 {
                color: #6610f2;
                margin-bottom: 15px;
                display: flex;
                align-items: center;
                gap: 10px;
            }

            .chart-table {
                width: 100%;
                border-collapse: collapse;
                margin-top: 10px;
            }

            .chart-table th, .chart-table td {
                border: 1px solid #dee2e6;
                padding: 10px;
                text-align: center;
            }

            .chart-table th {
                background: #6610f2;
                color: white;
            }

            .chart-table tr:nth-child(even) {
                background: #f8f9fa;
            }

            .conversion-history {
                max-height: 300px;
                overflow-y: auto;
                margin-top: 20px;
            }

            .history-item {
                background: #f8f9fa;
                border-radius: 8px;
                padding: 15px;
                margin-bottom: 10px;
                border-left: 3px solid #6610f2;
            }

            .history-header {
                display: flex;
                justify-content: space-between;
                margin-bottom: 8px;
                font-weight: 600;
                color: #6610f2;
            }

            .history-details {
                font-size: 14px;
                color: #666;
            }

            .unit-toggle {
                display: flex;
                gap: 10px;
                margin-bottom: 15px;
            }

            .unit-btn {
                flex: 1;
                padding: 8px;
                border: 2px solid #e1e8ed;
                border-radius: 6px;
                background: white;
                cursor: pointer;
                font-weight: 500;
            }

            .unit-btn.active {
                border-color: #6610f2;
                background: #f0e6ff;
                color: #6610f2;
            }

            .favorite-sizes {
                margin-top: 20px;
            }

            .favorite-item {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 10px;
                background: #f8f9fa;
                border-radius: 6px;
                margin-bottom: 8px;
            }

            .favorite-actions {
                display: flex;
                gap: 10px;
            }

            .favorite-btn {
                background: none;
                border: none;
                color: #6610f2;
                cursor: pointer;
                font-size: 16px;
            }

            .favorite-btn.delete {
                color: #dc3545;
            }

            .hat-styles {
                display: grid;
                grid-template-columns: repeat(3, 1fr);
                gap: 15px;
                margin-top: 20px;
            }

            .hat-style {
                text-align: center;
                padding: 15px;
                background: #f8f9fa;
                border-radius: 8px;
                cursor: pointer;
                transition: all 0.3s;
            }

            .hat-style:hover {
                background: #e6d9ff;
                transform: translateY(-3px);
            }

            .hat-style i {
                font-size: 24px;
                color: #6610f2;
                margin-bottom: 10px;
            }

            .hat-style.active {
                background: #6610f2;
                color: white;
            }

            .hat-style.active i {
                color: white;
            }
        }

        /* Mobile Styles */
        @media (max-width: 768px) {
            header {
                background: linear-gradient(90deg, #6610f2, #520dc2);
                color: white;
                padding: 0 15px;
                height: 50px;
                display: flex;
                align-items: center;
                justify-content: center;
                box-shadow: 0 2px 5px rgba(0,0,0,0.1);
                position: sticky;
                top: 0;
                z-index: 100;
            }

            h1 {
                font-size: 18px;
                font-weight: 600;
                text-align: center;
            }

            .container {
                padding: 20px 15px;
                display: flex;
                flex-direction: column;
                gap: 20px;
            }

            .card {
                background: white;
                border-radius: 12px;
                padding: 20px;
                box-shadow: 0 3px 10px rgba(0,0,0,0.08);
            }

            h2 {
                color: #6610f2;
                margin-bottom: 15px;
                font-size: 18px;
                display: flex;
                align-items: center;
                gap: 8px;
            }

            .form-group {
                margin-bottom: 15px;
            }

            label {
                display: block;
                margin-bottom: 6px;
                font-weight: 500;
                color: #333;
                font-size: 14px;
            }

            input, select, textarea {
                width: 100%;
                padding: 10px 12px;
                border: 2px solid #e1e8ed;
                border-radius: 6px;
                font-size: 14px;
            }

            button {
                background: linear-gradient(90deg, #6610f2, #520dc2);
                color: white;
                border: none;
                padding: 12px 20px;
                border-radius: 6px;
                cursor: pointer;
                font-size: 14px;
                font-weight: 600;
                width: 100%;
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 6px;
            }

            .btn-secondary {
                background: linear-gradient(90deg, #6c757d, #495057);
            }

            .btn-danger {
                background: linear-gradient(90deg, #dc3545, #a71e2a);
            }

            .btn-info {
                background: linear-gradient(90deg, #17a2b8, #117a8b);
            }

            .conversion-results {
                background: #f8f9fa;
                border-radius: 8px;
                padding: 20px;
                margin-top: 15px;
                border-left: 3px solid #6610f2;
            }

            .result-item {
                display: flex;
                justify-content: space-between;
                padding: 10px 0;
                border-bottom: 1px solid #e9ecef;
                font-size: 14px;
            }

            .result-item:last-child {
                border-bottom: none;
            }

            .result-label {
                font-weight: 500;
                color: #495057;
            }

            .result-value {
                font-weight: 600;
                color: #6610f2;
            }

            .no-results {
                text-align: center;
                color: #666;
                padding: 20px;
                font-style: italic;
                font-size: 14px;
            }

            .clear-data {
                margin-top: 15px;
                text-align: center;
            }

            .stats-container {
                display: grid;
                grid-template-columns: repeat(3, 1fr);
                gap: 10px;
                margin-bottom: 20px;
            }

            .stat-card {
                background: linear-gradient(135deg, #6610f2, #520dc2);
                color: white;
                padding: 15px 10px;
                border-radius: 8px;
                text-align: center;
            }

            .stat-number {
                font-size: 18px;
                font-weight: bold;
                margin-bottom: 3px;
            }

            .stat-label {
                font-size: 12px;
                opacity: 0.9;
            }

            .filter-section {
                display: flex;
                flex-direction: column;
                gap: 10px;
                margin-bottom: 15px;
            }

            .reminder-section {
                background: #fff3cd;
                border-left: 3px solid #ffc107;
                padding: 12px;
                border-radius: 6px;
                margin-bottom: 15px;
            }

            .reminder-section h3 {
                color: #856404;
                margin-bottom: 8px;
                font-size: 16px;
                display: flex;
                align-items: center;
                gap: 8px;
            }

            .reminder-section ul {
                padding-left: 15px;
            }

            .reminder-section li {
                margin-bottom: 6px;
                color: #666;
                font-size: 13px;
            }

            .size-chart {
                margin-top: 20px;
            }

            .size-chart h3 {
                color: #6610f2;
                margin-bottom: 12px;
                font-size: 16px;
                display: flex;
                align-items: center;
                gap: 8px;
            }

            .chart-table {
                width: 100%;
                border-collapse: collapse;
                margin-top: 10px;
                font-size: 12px;
            }

            .chart-table th, .chart-table td {
                border: 1px solid #dee2e6;
                padding: 8px 5px;
                text-align: center;
            }

            .chart-table th {
                background: #6610f2;
                color: white;
            }

            .chart-table tr:nth-child(even) {
                background: #f8f9fa;
            }

            .conversion-history {
                max-height: 250px;
                overflow-y: auto;
                margin-top: 15px;
            }

            .history-item {
                background: #f8f9fa;
                border-radius: 6px;
                padding: 12px;
                margin-bottom: 8px;
                border-left: 2px solid #6610f2;
            }

            .history-header {
                display: flex;
                justify-content: space-between;
                margin-bottom: 6px;
                font-weight: 600;
                color: #6610f2;
                font-size: 14px;
            }

            .history-details {
                font-size: 12px;
                color: #666;
            }

            .unit-toggle {
                display: flex;
                gap: 5px;
                margin-bottom: 15px;
            }

            .unit-btn {
                flex: 1;
                padding: 6px;
                border: 2px solid #e1e8ed;
                border-radius: 4px;
                background: white;
                cursor: pointer;
                font-weight: 500;
                font-size: 12px;
            }

            .unit-btn.active {
                border-color: #6610f2;
                background: #f0e6ff;
                color: #6610f2;
            }

            .favorite-sizes {
                margin-top: 15px;
            }

            .favorite-item {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 8px;
                background: #f8f9fa;
                border-radius: 5px;
                margin-bottom: 6px;
                font-size: 13px;
            }

            .favorite-actions {
                display: flex;
                gap: 8px;
            }

            .favorite-btn {
                background: none;
                border: none;
                color: #6610f2;
                cursor: pointer;
                font-size: 14px;
            }

            .favorite-btn.delete {
                color: #dc3545;
            }

            .hat-styles {
                display: grid;
                grid-template-columns: repeat(3, 1fr);
                gap: 10px;
                margin-top: 15px;
            }

            .hat-style {
                text-align: center;
                padding: 10px;
                background: #f8f9fa;
                border-radius: 6px;
                cursor: pointer;
                transition: all 0.3s;
                font-size: 12px;
            }

            .hat-style:hover {
                background: #e6d9ff;
                transform: translateY(-2px);
            }

            .hat-style i {
                font-size: 18px;
                color: #6610f2;
                margin-bottom: 5px;
            }

            .hat-style.active {
                background: #6610f2;
                color: white;
            }

            .hat-style.active i {
                color: white;
            }
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            z-index: 1000;
            transform: translateX(200%);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: linear-gradient(90deg, #28a745, #1e7e34);
        }

        .notification.error {
            background: linear-gradient(90deg, #dc3545, #a71e2a);
        }

        .notification.warning {
            background: linear-gradient(90deg, #ffc107, #d39e00);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
        }

        .export-btn {
            background: linear-gradient(90deg, #17a2b8, #117a8b);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 10px;
        }

        .size-input-container {
            display: flex;
            gap: 10px;
        }

        .size-input-container input {
            flex: 1;
        }

        .measurement-instructions {
            background: #e6d9ff;
            border-left: 4px solid #6610f2;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .measurement-instructions h3 {
            color: #520dc2;
            margin-bottom: 10px;
        }

        .measurement-instructions ol {
            padding-left: 20px;
        }

        .measurement-instructions li {
            margin-bottom: 8px;
            color: #495057;
        }

        .fit-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
            padding: 10px;
            border-radius: 6px;
            background: #f8f9fa;
        }

        .fit-indicator.good {
            background: #d4edda;
            border-left: 4px solid #28a745;
        }

        .fit-indicator.tight {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
        }

        .fit-indicator.loose {
            background: #f8d7da;
            border-left: 4px solid #dc3545;
        }
    </style>
</head>
<body>
    <header>
        <h1><i class="fas fa-hat-cowboy"></i> Hat Size Calculator</h1>
    </header>

    <div class="container">
        <div class="card">
            <h2><i class="fas fa-calculator"></i> Calculate Your Hat Size</h2>
            
            <div class="reminder-section">
                <h3><i class="fas fa-lightbulb"></i> Measurement Tips</h3>
                <ul>
                    <li>Measure around your head about 1 inch above your eyebrows</li>
                    <li>Use a flexible measuring tape or string and ruler</li>
                    <li>Measure when your hair is flat, not puffy</li>
                </ul>
            </div>
            
            <div class="measurement-instructions">
                <h3><i class="fas fa-ruler"></i> How to Measure</h3>
                <ol>
                    <li>Use a flexible measuring tape or a piece of string</li>
                    <li>Wrap it around your head about 1 inch above your eyebrows</li>
                    <li>Make sure the tape is level all the way around</li>
                    <li>Record the measurement where the tape overlaps</li>
                </ol>
            </div>
            
            <form id="hatSizeForm">
                <div class="unit-toggle">
                    <button class="unit-btn active" data-unit="metric">Metric (cm)</button>
                    <button class="unit-btn" data-unit="imperial">Imperial (in)</button>
                </div>
                
                <div class="form-group">
                    <label for="headCircumference"><i class="fas fa-ruler-combined"></i> Head Circumference</label>
                    <input type="number" id="headCircumference" step="0.1" required placeholder="Enter head circumference">
                </div>
                
                <div class="form-group">
                    <label for="hatStyle"><i class="fas fa-hat-cowboy"></i> Hat Style (Optional)</label>
                    <div class="hat-styles">
                        <div class="hat-style" data-style="baseball">
                            <i class="fas fa-baseball-ball"></i>
                            <div>Baseball</div>
                        </div>
                        <div class="hat-style" data-style="fedora">
                            <i class="fas fa-hat-cowboy"></i>
                            <div>Fedora</div>
                        </div>
                        <div class="hat-style" data-style="beanie">
                            <i class="fas fa-hat-wizard"></i>
                            <div>Beanie</div>
                        </div>
                    </div>
                    <input type="hidden" id="hatStyle" value="">
                </div>
                
                <button type="submit"><i class="fas fa-calculator"></i> Calculate Hat Size</button>
            </form>
        </div>
        
        <div class="card">
            <h2><i class="fas fa-list"></i> Hat Size Results</h2>
            
            <div class="stats-container">
                <div class="stat-card">
                    <div class="stat-number" id="totalCalculations">0</div>
                    <div class="stat-label">Calculations</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="favoriteSizes">0</div>
                    <div class="stat-label">Favorites</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="avgSize">--</div>
                    <div class="stat-label">Avg Size</div>
                </div>
            </div>
            
            <div class="conversion-results" id="conversionResults">
                <div class="no-results">Enter head measurement to calculate hat size</div>
            </div>
            
            <div class="favorite-sizes" id="favoriteSizesContainer">
                <h3><i class="fas fa-star"></i> Saved Sizes</h3>
                <div id="favoritesList">
                    <!-- Favorites will be loaded here -->
                </div>
            </div>
            
            <div class="size-chart">
                <h3><i class="fas fa-table"></i> Hat Size Chart</h3>
                <table class="chart-table">
                    <thead>
                        <tr>
                            <th>US Size</th>
                            <th>UK Size</th>
                            <th>Head Circumference (in)</th>
                            <th>Head Circumference (cm)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>6 3/4</td>
                            <td>6 1/2</td>
                            <td>21 1/4</td>
                            <td>54</td>
                        </tr>
                        <tr>
                            <td>6 7/8</td>
                            <td>6 5/8</td>
                            <td>21 5/8</td>
                            <td>55</td>
                        </tr>
                        <tr>
                            <td>7</td>
                            <td>6 3/4</td>
                            <td>22</td>
                            <td>56</td>
                        </tr>
                        <tr>
                            <td>7 1/8</td>
                            <td>6 7/8</td>
                            <td>22 3/8</td>
                            <td>57</td>
                        </tr>
                        <tr>
                            <td>7 1/4</td>
                            <td>7</td>
                            <td>22 3/4</td>
                            <td>58</td>
                        </tr>
                        <tr>
                            <td>7 3/8</td>
                            <td>7 1/8</td>
                            <td>23 1/8</td>
                            <td>59</td>
                        </tr>
                        <tr>
                            <td>7 1/2</td>
                            <td>7 1/4</td>
                            <td>23 1/2</td>
                            <td>60</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <div class="clear-data">
                <button class="btn-danger" id="clearDataBtn"><i class="fas fa-trash-alt"></i> Clear All Data</button>
                <button class="export-btn" id="exportBtn"><i class="fas fa-file-export"></i> Export Sizes</button>
            </div>
        </div>
    </div>

    <!-- Edit Modal -->
    <div class="modal" id="editModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-edit"></i> Edit Saved Size</h3>
                <button class="close-modal">&times;</button>
            </div>
            <form id="editForm">
                <input type="hidden" id="editId">
                <div class="form-group">
                    <label for="editName">Name</label>
                    <input type="text" id="editName" required>
                </div>
                <div class="form-group">
                    <label for="editHeadSize">Head Size</label>
                    <input type="text" id="editHeadSize" required>
                </div>
                <div class="form-group">
                    <label for="editHatSize">Hat Size</label>
                    <input type="text" id="editHatSize" required>
                </div>
                <button type="submit" class="btn-info"><i class="fas fa-save"></i> Update Size</button>
            </form>
        </div>
    </div>

    <div class="notification" id="notification"></div>

    <script>
        // DOM Elements
        const hatSizeForm = document.getElementById('hatSizeForm');
        const conversionResults = document.getElementById('conversionResults');
        const clearDataBtn = document.getElementById('clearDataBtn');
        const notification = document.getElementById('notification');
        const editModal = document.getElementById('editModal');
        const editForm = document.getElementById('editForm');
        const closeModal = document.querySelector('.close-modal');
        const exportBtn = document.getElementById('exportBtn');
        const unitButtons = document.querySelectorAll('.unit-btn');
        const hatStyles = document.querySelectorAll('.hat-style');
        const favoritesList = document.getElementById('favoritesList');

        // Stats elements
        const totalCalculationsEl = document.getElementById('totalCalculations');
        const favoriteSizesEl = document.getElementById('favoriteSizes');
        const avgSizeEl = document.getElementById('avgSize');

        // Current unit system
        let currentUnit = 'metric';
        let selectedHatStyle = '';

        // Load data from localStorage
        function loadData() {
            const calculations = JSON.parse(localStorage.getItem('hatSizeCalculations')) || [];
            const favorites = JSON.parse(localStorage.getItem('favoriteHatSizes')) || [];
            updateStats(calculations, favorites);
            displayFavorites(favorites);
        }

        // Update statistics
        function updateStats(calculations, favorites) {
            totalCalculationsEl.textContent = calculations.length;
            favoriteSizesEl.textContent = favorites.length;
            
            // Calculate average size
            if (calculations.length > 0) {
                const total = calculations.reduce((sum, calc) => sum + parseFloat(calc.headSize), 0);
                const avg = total / calculations.length;
                avgSizeEl.textContent = currentUnit === 'metric' ? 
                    avg.toFixed(1) + ' cm' : 
                    avg.toFixed(1) + ' in';
            } else {
                avgSizeEl.textContent = '--';
            }
        }

        // Display favorites
        function displayFavorites(favorites) {
            if (favorites.length === 0) {
                favoritesList.innerHTML = '<div class="no-results">No saved hat sizes</div>';
                return;
            }

            favoritesList.innerHTML = favorites.map(fav => `
                <div class="favorite-item">
                    <div>
                        <div><strong>${fav.name}</strong></div>
                        <div>${fav.headSize} → ${fav.hatSize}</div>
                    </div>
                    <div class="favorite-actions">
                        <button class="favorite-btn" data-id="${fav.id}" onclick="useFavorite('${fav.id}')">
                            <i class="fas fa-sync"></i>
                        </button>
                        <button class="favorite-btn delete" data-id="${fav.id}" onclick="deleteFavorite('${fav.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // Show notification
        function showNotification(message, type = 'success') {
            notification.textContent = message;
            notification.className = `notification ${type} show`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Calculate hat size based on head circumference
        function calculateHatSize(headCircumference, unit) {
            // Convert to inches if in cm
            let inches = unit === 'metric' ? headCircumference / 2.54 : headCircumference;
            
            // Hat size calculation (inches divided by 3.14159, then rounded to nearest 1/8)
            let hatSizeDecimal = inches / 3.14159;
            
            // Round to nearest 1/8
            let hatSize = Math.round(hatSizeDecimal * 8) / 8;
            
            // Convert to fraction format
            let whole = Math.floor(hatSize);
            let fraction = hatSize - whole;
            
            let fractionDisplay = '';
            if (fraction === 0.125) fractionDisplay = ' 1/8';
            else if (fraction === 0.25) fractionDisplay = ' 1/4';
            else if (fraction === 0.375) fractionDisplay = ' 3/8';
            else if (fraction === 0.5) fractionDisplay = ' 1/2';
            else if (fraction === 0.625) fractionDisplay = ' 5/8';
            else if (fraction === 0.75) fractionDisplay = ' 3/4';
            else if (fraction === 0.875) fractionDisplay = ' 7/8';
            
            let usSize = whole + fractionDisplay;
            
            // UK size is typically 1/4 size smaller
            let ukSizeDecimal = hatSizeDecimal - 0.25;
            let ukSize = Math.round(ukSizeDecimal * 8) / 8;
            let ukWhole = Math.floor(ukSize);
            let ukFraction = ukSize - ukWhole;
            
            let ukFractionDisplay = '';
            if (ukFraction === 0.125) ukFractionDisplay = ' 1/8';
            else if (ukFraction === 0.25) ukFractionDisplay = ' 1/4';
            else if (ukFraction === 0.375) ukFractionDisplay = ' 3/8';
            else if (ukFraction === 0.5) ukFractionDisplay = ' 1/2';
            else if (ukFraction === 0.625) ukFractionDisplay = ' 5/8';
            else if (ukFraction === 0.75) ukFractionDisplay = ' 3/4';
            else if (ukFraction === 0.875) ukFractionDisplay = ' 7/8';
            
            let ukSizeDisplay = ukWhole + ukFractionDisplay;
            
            // Determine fit
            let fit = '';
            if (fraction === 0) {
                fit = 'good';
            } else if (fraction < 0.25) {
                fit = 'tight';
            } else if (fraction > 0.75) {
                fit = 'loose';
            } else {
                fit = 'good';
            }
            
            return {
                usSize: usSize,
                ukSize: ukSizeDisplay,
                circumferenceInches: inches.toFixed(1),
                circumferenceCm: (inches * 2.54).toFixed(1),
                fit: fit
            };
        }

        // Display conversion results
        function displayResults(results, headSize) {
            let fitMessage = '';
            let fitClass = '';
            
            if (results.fit === 'good') {
                fitMessage = 'Perfect fit!';
                fitClass = 'good';
            } else if (results.fit === 'tight') {
                fitMessage = 'May run slightly small';
                fitClass = 'tight';
            } else {
                fitMessage = 'May run slightly large';
                fitClass = 'loose';
            }
            
            conversionResults.innerHTML = `
                <div class="result-item">
                    <span class="result-label">Head Size:</span>
                    <span class="result-value">${headSize} ${currentUnit === 'metric' ? 'cm' : 'in'}</span>
                </div>
                <div class="result-item">
                    <span class="result-label">US Hat Size:</span>
                    <span class="result-value">${results.usSize}</span>
                </div>
                <div class="result-item">
                    <span class="result-label">UK Hat Size:</span>
                    <span class="result-value">${results.ukSize}</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Circumference:</span>
                    <span class="result-value">${results.circumferenceInches} in / ${results.circumferenceCm} cm</span>
                </div>
                <div class="fit-indicator ${fitClass}">
                    <i class="fas fa-${results.fit === 'good' ? 'check-circle' : results.fit === 'tight' ? 'exclamation-triangle' : 'exclamation-circle'}"></i>
                    <span>${fitMessage}</span>
                </div>
                <div style="margin-top: 20px; text-align: center;">
                    <button class="btn-secondary" onclick="saveAsFavorite('${headSize} ${currentUnit === 'metric' ? 'cm' : 'in'}', '${results.usSize}')">
                        <i class="fas fa-star"></i> Save Size
                    </button>
                </div>
            `;
        }

        // Save calculation to history
        function saveCalculation(calculation) {
            const calculations = JSON.parse(localStorage.getItem('hatSizeCalculations')) || [];
            calculations.push({
                id: Date.now().toString(),
                ...calculation,
                timestamp: new Date().toISOString()
            });
            localStorage.setItem('hatSizeCalculations', JSON.stringify(calculations));
            loadData();
        }

        // Save as favorite
        function saveAsFavorite(headSize, hatSize) {
            const favorites = JSON.parse(localStorage.getItem('favoriteHatSizes')) || [];
            const name = prompt('Enter a name for this hat size:', `My Hat Size ${favorites.length + 1}`);
            if (name) {
                favorites.push({
                    id: Date.now().toString(),
                    name: name,
                    headSize: headSize,
                    hatSize: hatSize
                });
                localStorage.setItem('favoriteHatSizes', JSON.stringify(favorites));
                loadData();
                showNotification('Hat size saved!');
            }
        }

        // Use favorite
        function useFavorite(id) {
            const favorites = JSON.parse(localStorage.getItem('favoriteHatSizes')) || [];
            const favorite = favorites.find(fav => fav.id === id);
            if (favorite) {
                conversionResults.innerHTML = `
                    <div class="result-item">
                        <span class="result-label">Saved Size:</span>
                        <span class="result-value">${favorite.name}</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Head Size:</span>
                        <span class="result-value">${favorite.headSize}</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Hat Size:</span>
                        <span class="result-value">${favorite.hatSize}</span>
                    </div>
                `;
                showNotification('Saved hat size loaded!');
            }
        }

        // Delete favorite
        function deleteFavorite(id) {
            if (confirm('Are you sure you want to delete this saved size?')) {
                const favorites = JSON.parse(localStorage.getItem('favoriteHatSizes')) || [];
                const updatedFavorites = favorites.filter(fav => fav.id !== id);
                localStorage.setItem('favoriteHatSizes', JSON.stringify(updatedFavorites));
                loadData();
                showNotification('Saved size deleted!');
            }
        }

        // Clear all data
        function clearAllData() {
            if (confirm('Are you sure you want to clear all data? This cannot be undone.')) {
                localStorage.removeItem('hatSizeCalculations');
                localStorage.removeItem('favoriteHatSizes');
                loadData();
                conversionResults.innerHTML = '<div class="no-results">Enter head measurement to calculate hat size</div>';
                showNotification('All data cleared successfully!');
            }
        }

        // Export favorites
        function exportFavorites() {
            const favorites = JSON.parse(localStorage.getItem('favoriteHatSizes')) || [];
            if (favorites.length === 0) {
                showNotification('No saved sizes to export!', 'error');
                return;
            }
            
            const dataStr = JSON.stringify(favorites, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'hat_sizes.json';
            link.click();
            URL.revokeObjectURL(url);
            showNotification('Sizes exported successfully!');
        }

        // Toggle unit system
        function toggleUnit(unit) {
            currentUnit = unit;
            unitButtons.forEach(btn => {
                if (btn.dataset.unit === unit) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
            
            // Update input placeholder
            const input = document.getElementById('headCircumference');
            input.placeholder = currentUnit === 'metric' ? 
                'Enter head circumference (cm)' : 
                'Enter head circumference (in)';
        }

        // Select hat style
        function selectHatStyle(style) {
            selectedHatStyle = style;
            document.getElementById('hatStyle').value = style;
            
            hatStyles.forEach(hat => {
                if (hat.dataset.style === style) {
                    hat.classList.add('active');
                } else {
                    hat.classList.remove('active');
                }
            });
        }

        // Event Listeners
        hatSizeForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const headCircumference = parseFloat(document.getElementById('headCircumference').value);
            
            if (isNaN(headCircumference)) {
                showNotification('Please enter a valid head circumference', 'error');
                return;
            }
            
            // Validate reasonable range
            if (currentUnit === 'metric') {
                if (headCircumference < 45 || headCircumference > 75) {
                    showNotification('Please enter a realistic head circumference (45-75 cm)', 'error');
                    return;
                }
            } else {
                if (headCircumference < 18 || headCircumference > 30) {
                    showNotification('Please enter a realistic head circumference (18-30 inches)', 'error');
                    return;
                }
            }
            
            const results = calculateHatSize(headCircumference, currentUnit);
            
            displayResults(results, headCircumference);
            saveCalculation({
                headSize: headCircumference,
                unit: currentUnit,
                usSize: results.usSize,
                ukSize: results.ukSize,
                circumferenceInches: results.circumferenceInches,
                circumferenceCm: results.circumferenceCm
            });
        });

        clearDataBtn.addEventListener('click', clearAllData);
        exportBtn.addEventListener('click', exportFavorites);
        closeModal.addEventListener('click', function() {
            editModal.style.display = 'none';
        });
        window.addEventListener('click', function(e) {
            if (e.target === editModal) {
                editModal.style.display = 'none';
            }
        });

        // Unit toggle
        unitButtons.forEach(button => {
            button.addEventListener('click', function() {
                toggleUnit(this.dataset.unit);
            });
        });

        // Hat style selection
        hatStyles.forEach(style => {
            style.addEventListener('click', function() {
                selectHatStyle(this.dataset.style);
            });
        });

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            toggleUnit('metric'); // Set default unit
        });

        // Make functions available globally for inline event handlers
        window.useFavorite = useFavorite;
        window.deleteFavorite = deleteFavorite;
        window.saveAsFavorite = saveAsFavorite;
    </script>
</body>
</html>